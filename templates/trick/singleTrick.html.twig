{% extends 'layout.html.twig' %}
{% block main %}
    <main>
        <section class="intro-background">
            <div class="intro-trick" style="background-image: url({{ asset('build/images/surfeur.jpg') }});"></div>
        </section>
        <section class="content">
            <div id="content-trick" class="content-trick-container">
                <div class="content-header"
                        {% if trick.medias|length > 0 %}
                        {% set media = trick.medias|first %}
                     style="background-image: url({{ asset(pathMediaImage  ~ '/' ~ media.filename) }});">
                    {% else %}
                        style="background-image: url({{ asset(pathMediaImage  ~ '/' ~ 'default.jpg') }});">
                    {% endif %}
                    <div class="content-trick-image-title">
                        <h1>
                            {{ trick.title }}
                        </h1>
                    </div>
                    {% if is_granted('ROLE_USER') and app.user == trick.author %}
                        <div class="content-trick-image--icon">
                            <div id="pencil"><a href="{{ path('update_tricks', {'id': trick.id}) }}"><i
                                            class="fa-solid fa-pencil"></i></a>
                            </div>
                            <div id="trash-can"><a href="{{ path('update_tricks', {'id': trick.id}) }}"><i
                                            class="fa-solid fa-trash-can"></i></a>
                            </div>
                        </div>
                    {% endif %}
                </div>
                <div>
                    <div class="content-media-tricks">
                        {% set image_count = 0 %}
                        {% set video_count = 0 %}
                        {% for media in trick.medias %}
                            {% if media.type == 'image' and image_count < 3 %}
                                {% set image_count = image_count + 1 %}
                                <img src="{{ asset(pathMediaImage  ~ '/' ~ media.filename) }}" alt="{{ media.alt }}">
                            {% elseif media.type == 'video' and video_count < 2 %}
                                <video controls>
                                    <source src="{{ asset(pathMediaVideo  ~ '/' ~ media.filename) }}"
                                            type="video/mp4">
                                    Votre navigateur ne prend pas en charge la balise vidéo.
                                </video>
                                {% set image_count = image_count + 1 %}
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="content-media-tricks-external">
                        {% for externalVideo in trick.externalVideo %}
                            {% if externalVideo.platformId == 1 %}
                                <iframe type="text/html" width="640" height="360"
                                        src="{{ externalVideo.url }}">
                                </iframe>
                            {% else %}
                                <iframe type="text/html" src="{{ externalVideo.url }}" width="100%" height="100%"
                                        allowfullscreen title="Dailymotion Video Player" allow="autoplay"></iframe>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <button class="modal-btn  modal-trigger">
                        Voir les medias
                    </button>
                </div>
                <div class="content-description">
                    <p>
                        {{ trick.content }}
                    </p>
                </div>
                {% if is_granted('ROLE_USER') %}
                    <div class="content-form">
                        <div class="content-form--content">
                            {{ form_start(commentForm) }}
                            {{ form_row(commentForm.content, {'label':false}) }}
                            {{ form_row(commentForm.submit) }}
                            {{ form_end(commentForm) }}
                        </div>
                    </div>
                {% else %}
                    <div class="content-form">
                        <div class="content-form--content">
                            <p>Veuillez vous connecté pour pouvoir poster un commentaire</p>
                        </div>
                    </div>
                {% endif %}
                <div class="content-comment-container">
                    <div class="content-comment">
                        {% include 'comment/comments.html.twig' with {'comments': comments} %}
                    </div>
                    <div id="expand" class="d-flex">
                        <div id="expand" class="d-flex">
                            {% if comments.currentPageNumber < maxPage %}
                                <button id="load-more" data-current-page="{{ comments.currentPageNumber + 1 }}"
                                        data-max-page="{{ maxPage }}"> Load More
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="modal-container">
            <div class="overlay modal-trigger"></div>
            <div class="modal">
                <button class="close-modal modal-trigger">
                    X
                </button>
                <h1>Voici les medias: </h1>
                <div class="content-media-tricks-expands">
                    {% set image_count = 0 %}
                    {% set video_count = 0 %}
                    {% for media in trick.medias %}
                        {% if media.type == 'image' and image_count < 3 %}
                            {% set image_count = image_count + 1 %}
                            <img src="{{ asset(pathMediaImage  ~ '/' ~ media.filename) }}"
                                 alt="{{ media.alt }}">
                        {% elseif media.type == 'video' and video_count < 2 %}
                            <video controls>
                                <source src="{{ asset(pathMediaVideo  ~ '/' ~ media.filename) }}"
                                        type="video/mp4">
                                Votre navigateur ne prend pas en charge la balise vidéo.
                            </video>
                            {% set image_count = image_count + 1 %}
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="content-media-tricks-external--expand">
                    {% for externalVideo in trick.externalVideo %}
                        {% if externalVideo.platformId == 1 %}
                            <iframe type="text/html" width="640" height="360"
                                    src="{{ externalVideo.url }}">
                            </iframe>
                        {% else %}
                            <iframe type="text/html" src="{{ externalVideo.url }}" width="100%"
                                    height="100%"
                                    allowfullscreen title="Dailymotion Video Player"
                                    allow="autoplay"></iframe>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>
    {% include 'navbar-mobile.html.twig' %}
    {{ encore_entry_script_tags('paginateComment') }}
{% endblock %}
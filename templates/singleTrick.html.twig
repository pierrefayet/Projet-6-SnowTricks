{% extends 'layout.html.twig' %}
{% block main %}
    <main>
        <section class="intro-background">
            <div class="intro-trick" style="background-image: url({{ asset('build/images/surfeur.jpg') }});"></div>
        </section>
        <section class="content">
            <div id="content-trick">
                <div class="content-header"
                     style="background-image: url({{ asset('build/images/50_50_Grinds.51e6a335.png') }});">
                    <div class="content-trick-image-title">
                        <h1>
                            {{ trick.title }}
                        </h1>
                    </div>
                    {% if is_granted('ROLE_USER') and app.user == trick.author %}
                    <div class="content-trick-image--icon">
                        <div id="pencil"><a href="/update_tricks/{{ trick.id }}"><i class="fa-solid fa-pencil"></i></a>
                        </div>
                        <div id="trash-can"><a href="/delete_trick/{{ trick.id }}"><i class="fa-solid fa-trash-can"></i></a>
                        </div>
                    </div>
                    {% endif %}
                </div>
                <div>
                    <div class="content-media-tricks">
                        {% set image_count = 0 %}
                        {% set video_count = 0 %}
                        {% for media in trick.medias %}
                            {% if media.type == 'image' and image_count < 3 %}
                                {% set image_count = image_count + 1 %}
                                <img src="{{ asset(pathMediaImage  ~ '/' ~ media.filename) }}" alt="{{ media.alt }}">
                            {% elseif media.type == 'video' and video_count < 2 %}
                                <video controls>
                                    <source src="{{ asset(pathMediaVideo  ~ '/' ~ media.filename) }}"
                                            type="video/mp4">
                                    Votre navigateur ne prend pas en charge la balise vid√©o.
                                </video>
                                {% set image_count = image_count + 1 %}
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="media-expand">
                        <div class="media-expand-content">See medias</div>
                    </div>
                    <div class="content-description">
                        <p>
                            {{ trick.content }}
                        </p>
                    </div>
                    <div class="content-information">
                        {% for tag in trick.tags|slice(0,4) %}
                            <div class="content-information-item">{{ tag.name }}</div>
                        {% endfor %}
                    </div>
                    {% if is_granted('ROLE_USER') %}
                    <div class="content-form">
                        <div class="content-form--content">
                            {{ form_start(commentForm, {'action': path('add_comment', {'id': trick.id}), 'method': 'POST'}) }}
                            {{ form_row(commentForm.content, {'label':false}) }}
                            {{ form_row(commentForm.submit) }}
                            {{ form_end(commentForm) }}
                        </div>
                    </div>
                    {% endif %}
                    <div class="content-comment-container">
                        <div class="content-comment">
                            {% if comments is not empty %}
                                {% for comment in comments %}
                                    <div class="content-comment-items">
                                        <div class="content-comment--icon">
                                            {% if comment.commentUserId.userImage %}
                                                <img  height="50" src="{{ asset(pathMediaAvatar  ~ '/' ~  comment.commentUserId.userImage) }}" alt="profil image">
                                            {% else %}
                                                <i class="fa-solid fa-user"></i>
                                            {% endif %}
                                        </div>
                                        <div class="content-comment--content">
                                            <p>{{ comment.content }}</p>
                                            <p>''</p>
                                            <p>{{ comment.commentUserId.userName }}</p>
                                            <p>{{ comment.creationDate|date('d/m/Y') }}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                {# debug #}
                                <div class="no-comments">
                                    <p>No comments yet.</p>
                                </div>
                            {% endif %}
                        </div>
                        <div class="container-expand">
                            <div id="expand">
                                <div>
                                    <p><i class="fa-solid fa-spinner"></i></p>
                                </div>
                                <div>
                                    <p>Load more</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <div class="navbar-mobile">
        <ul>
            <li><a href="{{ path('home') }}"><i class="fa-solid fa-house"></i></a></li>
            <li><a href="/single_trick"><i class="fa-solid fa-bookmark"></i></a></li>
            <li><a href="{{ path('security_login') }}"><i class="fa-solid fa-user"></i></a></li>
            <!-- <li><i class="fa-solid fa-right-from-bracket"></i></li> -->
        </ul>
    </div>
{% endblock %}
{# TODO faire une pagination sur load more des comments en php #}